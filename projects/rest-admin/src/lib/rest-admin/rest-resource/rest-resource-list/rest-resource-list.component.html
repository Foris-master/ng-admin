<nb-card status="primary">
  <nb-card-header>
    <div class="row d-flex justify-content-between">
      <div class="d-flex align-items-center">
        <h6 class="text-white">
          {{ this.resource.listConfig.title }}
        </h6>
      </div>

      <div class="" *ngIf="showCheckbox">
        <button nbButton ghost status="control" (click)="selectAllRows()">
          <input
            class="mr-2"
            type="checkbox"
            [checked]="this.selectedRows?.length == this.source.count()"
          />Selectionner
        </button>
      </div>

      <div class="" style="height: 40px">
        <button nbButton ghost (click)="toggleShowCheckbox()">
          <input type="checkbox" [(ngModel)]="showCheckbox" />
        </button>

        <button
          nbButton
          [nbContextMenu]="items"
          nbContextMenuTag="my-context"
          ghost
          status="control"
        >
          <nb-icon icon="download-outline"></nb-icon>
        </button>

        <ng-container *ngIf="resource.permissions.length === 0">
          <button nbButton ghost status="control" (click)="addNewEntity()">
            <span>{{ "add" | translate }}</span>
            <nb-icon icon="plus-circle"></nb-icon>
          </button>

          <button
            nbButton
            *ngIf="this.selectedRows?.length > 0"
            ghost
            status="control"
            (click)="onDeleteAllConfirm()"
          >
            <nb-icon
              icon="trash"
              color="danger"
              style="color: rgb(238, 130, 157)"
            ></nb-icon>
          </button>
        </ng-container>

        <ng-container *ngIf="resource.permissions.length > 0">
          <ng-container *ngxPermissionsOnly="permissions">
            <ng-container *ngxPermissionsOnly="PERMISSION.CREATE">
              <button nbButton ghost status="control" (click)="addNewEntity()">
                <span>{{ "add" | translate }}</span>
                <nb-icon icon="plus-circle"></nb-icon>
              </button>
            </ng-container>

            <ng-container *ngxPermissionsOnly="PERMISSION.DELETE">
              <button
                nbButton
                *ngIf="this.selectedRows?.length > 0"
                ghost
                status="control"
                (click)="onDeleteAllConfirm()"
              >
                <nb-icon
                  icon="trash"
                  color="danger"
                  style="color: rgb(238, 130, 157)"
                ></nb-icon>
              </button>
            </ng-container>
          </ng-container>
        </ng-container>

        <!-- <button
          nbButton
          status="primary"
          [nbContextMenu]="items"
          nbContextMenuTag="my-context"
        >
          {{ "rest-list.export" | translate }}
        </button> -->
      </div>
    </div>
  </nb-card-header>

  <nb-card-body
    [nbSpinner]="this.restShare.listLoader"
    nbSpinnerSize="large"
    nbSpinnerStatus="primary"
  >
    <!-- Rest-search implement -->
    <div class="row mb-5" *ngIf="this.resource.listConfig.searchFilter">
      <ng-container
        *ngIf="this.resource.listConfig.searchFilter.filterBy.length > 0"
      >
        <ng-container *ngFor="let search of searchItems; let index = index">
          <div class="col-lg-3 col-md-6 col-xs-12 input-space">
            <!-- Select with filter by -->
            <nb-select
              [placeholder]="'rest-list.filterPlaceholder' | translate"
              fullWidth
              (selectedChange)="selectFilterBy($event, index)"
            >
              <nb-option
                *ngFor="
                  let filter of this.resource.listConfig.searchFilter.filterBy
                "
                [value]="filter"
                >{{ filter["name"] | titlecase }}</nb-option
              >
            </nb-select>
          </div>
          <ng-container *ngIf="this.searchItems[index].field !== 'id'">
            <div class="col-lg-3 col-md-6 col-xs-12 input-space">
              <nb-select
                [placeholder]="'rest-list.operator' | translate"
                fullWidth
                (selectedChange)="selectOperator($event, index)"
              >
                <nb-option
                  *ngFor="let operator of filterOperator"
                  [value]="operator.value"
                >
                  {{ operator.name | translate }}
                </nb-option>
              </nb-select>
            </div>
          </ng-container>

          <div
            *ngIf="this.searchItems[index].field !== 'id'"
            class="col-lg-4 col-md-12 col-xs-12 input-space"
            [ngClass]="{
              'col-12': this.resource.listConfig.searchFilter == null
            }"
          >
            <input
              nbInput
              (input)="onFilter($event.target, index)"
              fullWidth
              [placeholder]="'rest-list.searchPlaceholder' | translate"
              type="text"
            />
          </div>
          <div [formGroup]="form">
            <ng-container *ngIf="this.searchItems[index].field === 'id'">
              <div class="input-space">
                <!-- <label class="label">{{ field.label | titlecase }}</label> -->
                <nb-tag-list (tagRemove)="onTagRemoveBelong($event)">
                  <nb-tag
                    *ngFor="let tree of belongToMany['id']"
                    [text]="tree['name']"
                    removable
                  ></nb-tag>
                  <input
                    type="text"
                    nbTagInput
                    #autoBelongToMany
                    [nbAutocomplete]="belongToField"
                    (keyup)="filterInput($event, index)"
                    [placeholder]="
                      this.searchItems[index].fieldName
                        ? this.searchItems[index].fieldName
                        : 'id'
                    "
                    [formControlName]="'id'"
                    fullWidth
                  />
                </nb-tag-list>

                <nb-autocomplete
                  #belongToField
                  (selectedChange)="onChoose($event, index)"
                >
                  <nb-option
                    *ngFor="let option of allFilterContains['id'] | async"
                    [value]="option"
                  >
                    {{
                      option[
                        this.searchItems[index].fieldName
                          ? this.searchItems[index].fieldName
                          : "id"
                      ]
                    }}
                  </nb-option>
                </nb-autocomplete>
              </div>
            </ng-container>
          </div>

          <div
            class="col-lg-1 col-md-2 col-xs-4 input-space row"
            *ngIf="index == 0"
          >
            <button nbButton fullWidth status="primary" (click)="startSearch()">
              <nb-icon icon="search-outline"></nb-icon>
            </button>
          </div>
          <div
            class="col-lg-1 col-md-2 col-xs-4 input-space"
            *ngIf="index == 0; else elseBlock"
          >
            <button
              nbButton
              fullWidth
              status="primary"
              (click)="addFieldSearch()"
            >
              <nb-icon icon="plus-outline"></nb-icon>
            </button>
          </div>
          <ng-template #elseBlock>
            <div class="col-lg-1 input-space">
              <button
                nbButton
                fullWidth
                status="danger"
                (click)="removeFieldSearch(index)"
              >
                <nb-icon icon="minus-outline"></nb-icon>
              </button>
            </div>
          </ng-template>
        </ng-container>
      </ng-container>
    </div>

    <!-- <ng2-smart-table
    *ngIf="showCheckbox"
      [settings]="{...settings, columns: { ...settings.columns, isChecked } }"
      [source]="source"
      (deleteConfirm)="onDeleteConfirm($event)"
      (createConfirm)="onCreateConfirm($event)"
      (custom)="onCustom($event)"
      (userRowSelect)="detailEntity($event)"
    >
    </ng2-smart-table> -->

    <!-- *ngIf="!showCheckbox" -->

    <ng-container *ngIf="resource.permissions.length > 0">
      <ng2-smart-table
        [settings]="settings"
        [source]="source"
        (deleteConfirm)="onDeleteConfirm($event)"
        (createConfirm)="onCreateConfirm($event)"
        (custom)="onCustom($event)"
        (userRowSelect)="detailEntity($event)"
        *ngIf="custom"
      >
      </ng2-smart-table>
    </ng-container>

    <ng-container *ngIf="resource.permissions.length === 0">
      <ng2-smart-table
        [settings]="settings"
        [source]="source"
        (deleteConfirm)="onDeleteConfirm($event)"
        (createConfirm)="onCreateConfirm($event)"
        (custom)="onCustom($event)"
        (userRowSelect)="detailEntity($event)"
      >
      </ng2-smart-table>
    </ng-container>
    <div
      class="row align-items-center justify-content-end"
      style="margin-top: 1rem"
    >
      <label class="label mx-2">{{ "options.per_page" | translate }}</label>
      <nb-select
        [placeholder]="resource.listConfig.perPage.toString()"
        [(selected)]="currentPerPage"
      >
        <nb-option
          *ngFor="let perPage of perPagesOptions"
          (click)="setPager(perPage.value)"
          value="perPage.value"
          >{{ perPage.title }}</nb-option
        >
      </nb-select>
    </div>
  </nb-card-body>
</nb-card>
