import { Component } from '@angular/core';
import { Subject } from 'rxjs';
import { RestAdminConfigService } from '../../../../lib/rest-admin/rest-resource/service/rest-admin-config.service';
import { GLOBALS } from '../../../utils/globals';
import { filter, map, takeUntil } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@nebular/theme";
import * as i2 from "../../../@core/utils";
import * as i3 from "../../../../lib/rest-admin/rest-resource/service/rest-admin-config.service";
import * as i4 from "@nebular/auth";
import * as i5 from "@angular/router";
import * as i6 from "../../../../lib/rest-admin/rest-resource/service/rest-lang.service";
import * as i7 from "@angular/common/http";
import * as i8 from "@angular/common";
import * as i9 from "@nebular/security";
export class HeaderComponent {
    constructor(sidebarService, menuService, themeService, layoutService, breakpointService, serviceRestAdmin, authService, router, langService, httpClient) {
        this.sidebarService = sidebarService;
        this.menuService = menuService;
        this.themeService = themeService;
        this.layoutService = layoutService;
        this.breakpointService = breakpointService;
        this.serviceRestAdmin = serviceRestAdmin;
        this.authService = authService;
        this.router = router;
        this.langService = langService;
        this.httpClient = httpClient;
        this.destroy$ = new Subject();
        this.userPictureOnly = false;
        this.isAuth = false;
        this.themes = [
            {
                value: 'default',
                name: 'Light',
            },
            {
                value: 'dark',
                name: 'Dark',
            },
            {
                value: 'cosmic',
                name: 'Cosmic',
            },
            {
                value: 'corporate',
                name: 'Corporate',
            },
        ];
        this.currentTheme = 'default';
        this.appLanguage = [];
        this.currentLang = '';
        this.userMenu = [{ title: 'Déconnexion' }];
    }
    ngOnInit() {
        this.currentTheme = this.themeService.currentTheme;
        this.appLanguage = this.langService.getLanguages();
        this.currentLang = this.langService.selected;
        const authApp = JSON.parse(localStorage.getItem(GLOBALS.AUTH_APP_TOKEN));
        if (authApp && authApp.value) {
            this.httpClient
                .get(`${this.serviceRestAdmin.restBaseUrl}/${RestAdminConfigService._authParams.userInfoEndPoint}`)
                .subscribe((resp) => {
                const user = {
                    name: resp.original.full_name,
                    picture: resp.original.infos.logo,
                };
                this.user = user;
                this.isAuth = true;
            });
        }
        const { xl } = this.breakpointService.getBreakpointsMap();
        this.themeService
            .onMediaQueryChange()
            .pipe(map(([, currentBreakpoint]) => currentBreakpoint.width < xl), takeUntil(this.destroy$))
            .subscribe((isLessThanXl) => (this.userPictureOnly = isLessThanXl));
        this.themeService
            .onThemeChange()
            .pipe(map(({ name }) => name), takeUntil(this.destroy$))
            .subscribe((themeName) => (this.currentTheme = themeName));
        this.menuService
            .onItemClick()
            .pipe(filter(({ tag }) => tag === 'my-context-menu'), map(({ item: { title } }) => title))
            .subscribe((title) => {
            switch (title) {
                case 'Déconnexion':
                    this.httpClient
                        .post(`${this.serviceRestAdmin.restBaseUrl}/${RestAdminConfigService._authParams.logoutEndPoint}`, {})
                        .subscribe((resp) => {
                        localStorage.removeItem(GLOBALS.AUTH_APP_TOKEN);
                        this.router.navigateByUrl('/login');
                        this.isAuth = false;
                    }, (err) => {
                        localStorage.removeItem(GLOBALS.AUTH_APP_TOKEN);
                        this.router.navigateByUrl('/login');
                        this.isAuth = false;
                    });
                    break;
                default:
                    console.log('Non pris en charge');
                    break;
            }
        });
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    changeTheme(themeName) {
        this.themeService.changeTheme(themeName);
    }
    toggleSidebar() {
        this.sidebarService.toggle(true, 'menu-sidebar');
        this.layoutService.changeLayoutSize();
        return false;
    }
    navigateHome() {
        this.menuService.navigateHome();
        return false;
    }
    signin() {
        this.router.navigateByUrl('/auth/login');
    }
    sigout() {
        this.authService.logout('email');
    }
    changeLang(event) {
        this.langService.setLanguage(event);
    }
}
HeaderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.1.5", ngImport: i0, type: HeaderComponent, deps: [{ token: i1.NbSidebarService }, { token: i1.NbMenuService }, { token: i1.NbThemeService }, { token: i2.LayoutService }, { token: i1.NbMediaBreakpointsService }, { token: i3.RestAdminConfigService }, { token: i4.NbAuthService }, { token: i5.Router }, { token: i6.RestLangService }, { token: i7.HttpClient }], target: i0.ɵɵFactoryTarget.Component });
HeaderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.1.5", type: HeaderComponent, selector: "ngx-header", ngImport: i0, template: "<div class=\"header-container\">\n  <div class=\"logo-container\">\n    <a (click)=\"toggleSidebar()\" href=\"#\" class=\"sidebar-toggle\">\n      <nb-icon icon=\"menu-2-outline\"></nb-icon>\n    </a>\n    <a class=\"logo\" href=\"#\" (click)=\"navigateHome()\"\n      ><span>{{ serviceRestAdmin.siteName }}</span></a\n    >\n  </div>\n  <nb-select\n    [selected]=\"currentTheme\"\n    (selectedChange)=\"changeTheme($event)\"\n    status=\"primary\"\n  >\n    <nb-option *ngFor=\"let theme of themes\" [value]=\"theme.value\">\n      {{ theme.name }}</nb-option\n    >\n  </nb-select>\n</div>\n\n<div class=\"header-container\">\n  <nb-select\n    [selected]=\"currentLang\"\n    (selectedChange)=\"changeLang($event)\"\n    status=\"primary\"\n  >\n    <nb-option *ngFor=\"let lang of appLanguage\" [value]=\"lang.value\">\n      {{ lang.value | uppercase }}</nb-option\n    >\n  </nb-select>\n\n  <nb-actions size=\"small\">\n    <!-- <nb-action class=\"control-item\">\n      <nb-search type=\"rotate-layout\"></nb-search>\n    </nb-action> -->\n\n    <nb-action class=\"user-action\" *nbIsGranted=\"['view', 'user']\">\n      <nb-user\n        [nbContextMenu]=\"userMenu\"\n        nbContextMenuTag=\"my-context-menu\"\n        [name]=\"user?.name\"\n        [picture]=\"user?.picture\"\n      >\n      </nb-user>\n    </nb-action>\n\n    <!-- <nb-action *ngIf=\"!isAuth\"\n      ><button nbButton (click)=\"signin()\" status=\"primary\">\n        Connexion\n      </button></nb-action\n    > -->\n  </nb-actions>\n</div>\n", styles: ["@use \"@nebular/theme/styles/themes/default\";.nb-theme-default :host{display:flex;justify-content:space-between;width:100%}.nb-theme-default :host .logo-container{display:flex;align-items:center;width:calc(16rem - 1.25rem)}.nb-theme-default :host nb-action{height:auto;display:flex;align-content:center}.nb-theme-default :host nb-user{cursor:pointer}.nb-theme-default :host ::ng-deep nb-search button{padding:0!important}.nb-theme-default :host .header-container{display:flex;align-items:center;width:auto}.nb-theme-default :host .header-container .sidebar-toggle{text-decoration:none;color:#8f9bb3}[dir=ltr] .nb-theme-default :host .header-container .sidebar-toggle{padding-right:1.25rem}[dir=rtl] .nb-theme-default :host .header-container .sidebar-toggle{padding-left:1.25rem}.nb-theme-default :host .header-container .sidebar-toggle nb-icon{font-size:1.75rem}.nb-theme-default :host .header-container .logo{padding:0 1.25rem;font-size:1.75rem;white-space:nowrap;text-decoration:none}[dir=ltr] .nb-theme-default :host .header-container .logo{border-left:1px solid #edf1f7}[dir=rtl] .nb-theme-default :host .header-container .logo{border-right:1px solid #edf1f7}@media (max-width: 767.98px){.nb-theme-default :host .control-item{display:none}.nb-theme-default :host .user-action{border:none;padding:0}}@media (max-width: 575.98px){.nb-theme-default :host nb-select{display:none}}.nb-theme-dark :host{display:flex;justify-content:space-between;width:100%}.nb-theme-dark :host .logo-container{display:flex;align-items:center;width:calc(16rem - 1.25rem)}.nb-theme-dark :host nb-action{height:auto;display:flex;align-content:center}.nb-theme-dark :host nb-user{cursor:pointer}.nb-theme-dark :host ::ng-deep nb-search button{padding:0!important}.nb-theme-dark :host .header-container{display:flex;align-items:center;width:auto}.nb-theme-dark :host .header-container .sidebar-toggle{text-decoration:none;color:#8f9bb3}[dir=ltr] .nb-theme-dark :host .header-container .sidebar-toggle{padding-right:1.25rem}[dir=rtl] .nb-theme-dark :host .header-container .sidebar-toggle{padding-left:1.25rem}.nb-theme-dark :host .header-container .sidebar-toggle nb-icon{font-size:1.75rem}.nb-theme-dark :host .header-container .logo{padding:0 1.25rem;font-size:1.75rem;white-space:nowrap;text-decoration:none}[dir=ltr] .nb-theme-dark :host .header-container .logo{border-left:1px solid #151a30}[dir=rtl] .nb-theme-dark :host .header-container .logo{border-right:1px solid #151a30}@media (max-width: 767.98px){.nb-theme-dark :host .control-item{display:none}.nb-theme-dark :host .user-action{border:none;padding:0}}@media (max-width: 575.98px){.nb-theme-dark :host nb-select{display:none}}.nb-theme-cosmic :host{display:flex;justify-content:space-between;width:100%}.nb-theme-cosmic :host .logo-container{display:flex;align-items:center;width:calc(16rem - 1.25rem)}.nb-theme-cosmic :host nb-action{height:auto;display:flex;align-content:center}.nb-theme-cosmic :host nb-user{cursor:pointer}.nb-theme-cosmic :host ::ng-deep nb-search button{padding:0!important}.nb-theme-cosmic :host .header-container{display:flex;align-items:center;width:auto}.nb-theme-cosmic :host .header-container .sidebar-toggle{text-decoration:none;color:#b4b4db}[dir=ltr] .nb-theme-cosmic :host .header-container .sidebar-toggle{padding-right:1.25rem}[dir=rtl] .nb-theme-cosmic :host .header-container .sidebar-toggle{padding-left:1.25rem}.nb-theme-cosmic :host .header-container .sidebar-toggle nb-icon{font-size:1.75rem}.nb-theme-cosmic :host .header-container .logo{padding:0 1.25rem;font-size:1.75rem;white-space:nowrap;text-decoration:none}[dir=ltr] .nb-theme-cosmic :host .header-container .logo{border-left:1px solid #1b1b38}[dir=rtl] .nb-theme-cosmic :host .header-container .logo{border-right:1px solid #1b1b38}@media (max-width: 767.98px){.nb-theme-cosmic :host .control-item{display:none}.nb-theme-cosmic :host .user-action{border:none;padding:0}}@media (max-width: 575.98px){.nb-theme-cosmic :host nb-select{display:none}}.nb-theme-corporate :host{display:flex;justify-content:space-between;width:100%}.nb-theme-corporate :host .logo-container{display:flex;align-items:center;width:calc(16rem - 1.25rem)}.nb-theme-corporate :host nb-action{height:auto;display:flex;align-content:center}.nb-theme-corporate :host nb-user{cursor:pointer}.nb-theme-corporate :host ::ng-deep nb-search button{padding:0!important}.nb-theme-corporate :host .header-container{display:flex;align-items:center;width:auto}.nb-theme-corporate :host .header-container .sidebar-toggle{text-decoration:none;color:#8f9bb3}[dir=ltr] .nb-theme-corporate :host .header-container .sidebar-toggle{padding-right:1.25rem}[dir=rtl] .nb-theme-corporate :host .header-container .sidebar-toggle{padding-left:1.25rem}.nb-theme-corporate :host .header-container .sidebar-toggle nb-icon{font-size:1.75rem}.nb-theme-corporate :host .header-container .logo{padding:0 1.25rem;font-size:1.75rem;white-space:nowrap;text-decoration:none}[dir=ltr] .nb-theme-corporate :host .header-container .logo{border-left:1px solid #edf1f7}[dir=rtl] .nb-theme-corporate :host .header-container .logo{border-right:1px solid #edf1f7}@media (max-width: 767.98px){.nb-theme-corporate :host .control-item{display:none}.nb-theme-corporate :host .user-action{border:none;padding:0}}@media (max-width: 575.98px){.nb-theme-corporate :host nb-select{display:none}}\n"], components: [{ type: i1.NbIconComponent, selector: "nb-icon", inputs: ["config", "icon", "pack", "status", "options"] }, { type: i1.NbSelectComponent, selector: "nb-select", inputs: ["size", "status", "shape", "appearance", "placeholder", "optionsOverlayOffset", "scrollStrategy", "outline", "filled", "hero", "disabled", "fullWidth", "compareWith", "selected", "multiple", "optionsListClass", "optionsPanelClass"], outputs: ["selectedChange"] }, { type: i1.NbOptionComponent, selector: "nb-option", inputs: ["disabled", "value"], outputs: ["selectionChange"] }, { type: i1.NbActionsComponent, selector: "nb-actions", inputs: ["size", "fullWidth"] }, { type: i1.NbActionComponent, selector: "nb-action", inputs: ["title", "badgeStatus", "disabled", "badgeDot", "link", "href", "icon", "badgeText", "badgePosition"] }, { type: i1.NbUserComponent, selector: "nb-user", inputs: ["name", "size", "shape", "badgeStatus", "picture", "showName", "showTitle", "showInitials", "onlyPicture", "title", "color", "badgeText", "badgePosition"] }], directives: [{ type: i8.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i9.NbIsGrantedDirective, selector: "[nbIsGranted]", inputs: ["nbIsGranted"] }, { type: i1.NbContextMenuDirective, selector: "[nbContextMenu]", inputs: ["nbContextMenuAdjustment", "nbContextMenuTrigger", "nbContextMenuPlacement", "nbContextMenuTag", "nbContextMenu", "nbContextMenuClass"] }], pipes: { "uppercase": i8.UpperCasePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.1.5", ngImport: i0, type: HeaderComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngx-header',
                    styleUrls: ['./header.component.scss'],
                    templateUrl: './header.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i1.NbSidebarService }, { type: i1.NbMenuService }, { type: i1.NbThemeService }, { type: i2.LayoutService }, { type: i1.NbMediaBreakpointsService }, { type: i3.RestAdminConfigService }, { type: i4.NbAuthService }, { type: i5.Router }, { type: i6.RestLangService }, { type: i7.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3Jlc3QtYWRtaW4vc3JjL2xpYi9AdGhlbWUvY29tcG9uZW50cy9oZWFkZXIvaGVhZGVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3Jlc3QtYWRtaW4vc3JjL2xpYi9AdGhlbWUvY29tcG9uZW50cy9oZWFkZXIvaGVhZGVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxTQUFTLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBUzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHL0IsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNEVBQTRFLENBQUM7QUFDcEgsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2pELE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7OztBQU14RCxNQUFNLE9BQU8sZUFBZTtJQThCMUIsWUFDVSxjQUFnQyxFQUNoQyxXQUEwQixFQUMxQixZQUE0QixFQUM1QixhQUE0QixFQUM1QixpQkFBNEMsRUFDN0MsZ0JBQXdDLEVBQ3ZDLFdBQTBCLEVBQzFCLE1BQWMsRUFDZCxXQUE0QixFQUM1QixVQUFzQjtRQVR0QixtQkFBYyxHQUFkLGNBQWMsQ0FBa0I7UUFDaEMsZ0JBQVcsR0FBWCxXQUFXLENBQWU7UUFDMUIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMkI7UUFDN0MscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF3QjtRQUN2QyxnQkFBVyxHQUFYLFdBQVcsQ0FBZTtRQUMxQixXQUFNLEdBQU4sTUFBTSxD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LENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQsV0FBVyxDQUFDLFNBQWlCO1FBQzNCLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxhQUFhO1FBQ1gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUV0QyxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNoQyxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUNELE1BQU07UUFDSixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQUs7UUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0QyxDQUFDOzs0R0FuSlUsZUFBZTtnR0FBZixlQUFlLGtEQ3RCNUIsMi9DQXFEQTsyRkQvQmEsZUFBZTtrQkFMM0IsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsWUFBWTtvQkFDdEIsU0FBUyxFQUFFLENBQUMseUJBQXlCLENBQUM7b0JBQ3RDLFdBQVcsRUFBRSx5QkFBeUI7aUJBQ3ZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IFJlc3RMYW5nU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL2xpYi9yZXN0LWFkbWluL3Jlc3QtcmVzb3VyY2Uvc2VydmljZS9yZXN0LWxhbmcuc2VydmljZSc7XG5pbXBvcnQgeyBDb21wb25lbnQsIE9uRGVzdHJveSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBOYk1lZGlhQnJlYWtwb2ludHNTZXJ2aWNlLFxuICBOYk1lbnVTZXJ2aWNlLFxuICBOYlNpZGViYXJTZXJ2aWNlLFxuICBOYlRoZW1lU2VydmljZSxcbn0gZnJvbSAnQG5lYnVsYXIvdGhlbWUnO1xuXG5pbXBvcnQgeyBMYXlvdXRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vQGNvcmUvdXRpbHMnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTmJBdXRoU2VydmljZSwgTmJBdXRoU2ltcGxlVG9rZW4gfSBmcm9tICdAbmVidWxhci9hdXRoJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBSZXN0QWRtaW5Db25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vbGliL3Jlc3QtYWRtaW4vcmVzdC1yZXNvdXJjZS9zZXJ2aWNlL3Jlc3QtYWRtaW4tY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgR0xPQkFMUyB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2dsb2JhbHMnO1xuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1oZWFkZXInLFxuICBzdHlsZVVybHM6IFsnLi9oZWFkZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgdGVtcGxhdGVVcmw6ICcuL2hlYWRlci5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIEhlYWRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgcHJpdmF0ZSBkZXN0cm95JDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIHVzZXJQaWN0dXJlT25seTogYm9vbGVhbiA9IGZhbHNlO1xuICB1c2VyOiBhbnk7XG4gIGlzQXV0aCA9IGZhbHNlO1xuICB0aGVtZXMgPSBbXG4gICAge1xuICAgICAgdmFsdWU6ICdkZWZhdWx0JyxcbiAgICAgIG5hbWU6ICdMaWdodCcsXG4gICAgfSxcbiAgICB7XG4gICAgICB2YWx1ZTogJ2RhcmsnLFxuICAgICAgbmFtZTogJ0RhcmsnLFxuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6ICdjb3NtaWMnLFxuICAgICAgbmFtZTogJ0Nvc21pYycsXG4gICAgfSxcbiAgICB7XG4gICAgICB2YWx1ZTogJ2NvcnBvcmF0ZScsXG4gICAgICBuYW1lOiAnQ29ycG9yYXRlJyxcbiAgICB9LFxuICBdO1xuXG4gIGN1cnJlbnRUaGVtZSA9ICdkZWZhdWx0JztcbiAgYXBwTGFuZ3VhZ2UgPSBbXTtcbiAgY3VycmVudExhbmcgPSAnJztcblxuICB1c2VyTWVudSA9IFt7IHRpdGxlOiAnRMOpY29ubmV4aW9uJyB9XTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHNpZGViYXJTZXJ2aWNlOiBOYlNpZGViYXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgbWVudVNlcnZpY2U6IE5iTWVudVNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0aGVtZVNlcnZpY2U6IE5iVGhlbWVTZXJ2aWNlLFxuICAgIHByaXZhdGUgbGF5b3V0U2VydmljZTogTGF5b3V0U2VydmljZSxcbiAgICBwcml2YXRlIGJyZWFrcG9pbnRTZXJ2aWNlOiBOYk1lZGlhQnJlYWtwb2ludHNTZXJ2aWNlLFxuICAgIHB1YmxpYyBzZXJ2aWNlUmVzdEFkbWluOiBSZXN0QWRtaW5Db25maWdTZXJ2aWNlLFxuICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IE5iQXV0aFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIGxhbmdTZXJ2aWNlOiBSZXN0TGFuZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50XG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmN1cnJlbnRUaGVtZSA9IHRoaXMudGhlbWVTZXJ2aWNlLmN1cnJlbnRUaGVtZTtcbiAgICB0aGlzLmFwcExhbmd1YWdlID0gdGhpcy5sYW5nU2VydmljZS5nZXRMYW5ndWFnZXMoKTtcbiAgICB0aGlzLmN1cnJlbnRMYW5nID0gdGhpcy5sYW5nU2VydmljZS5zZWxlY3RlZDtcblxuICAgIGNvbnN0IGF1dGhBcHAgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKEdMT0JBTFMuQVVUSF9BUFBfVE9LRU4pKTtcbiAgICBpZiAoYXV0aEFwcCAmJiBhdXRoQXBwLnZhbHVlKSB7XG4gICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgLmdldChcbiAgICAgICAgICBgJHt0aGlzLnNlcnZpY2VSZXN0QWRtaW4ucmVzdEJhc2VVcmx9LyR7UmVzdEFkbWluQ29uZmlnU2VydmljZS5fYXV0aFBhcmFtcy51c2VySW5mb0VuZFBvaW50fWBcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKChyZXNwOiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCB1c2VyID0ge1xuICAgICAgICAgICAgbmFtZTogcmVzcC5vcmlnaW5hbC5mdWxsX25hbWUsXG4gICAgICAgICAgICBwaWN0dXJlOiByZXNwLm9yaWdpbmFsLmluZm9zLmxvZ28sXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xuICAgICAgICAgIHRoaXMuaXNBdXRoID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgeGwgfSA9IHRoaXMuYnJlYWtwb2ludFNlcnZpY2UuZ2V0QnJlYWtwb2ludHNNYXAoKTtcbiAgICB0aGlzLnRoZW1lU2VydmljZVxuICAgICAgLm9uTWVkaWFRdWVyeUNoYW5nZSgpXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKChbLCBjdXJyZW50QnJlYWtwb2ludF0pID0+IGN1cnJlbnRCcmVha3BvaW50LndpZHRoIDwgeGwpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgIChpc0xlc3NUaGFuWGw6IGJvb2xlYW4pID0+ICh0aGlzLnVzZXJQaWN0dXJlT25seSA9IGlzTGVzc1RoYW5YbClcbiAgICAgICk7XG5cbiAgICB0aGlzLnRoZW1lU2VydmljZVxuICAgICAgLm9uVGhlbWVDaGFuZ2UoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgoeyBuYW1lIH0pID0+IG5hbWUpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKHRoZW1lTmFtZSkgPT4gKHRoaXMuY3VycmVudFRoZW1lID0gdGhlbWVOYW1lKSk7XG5cbiAgICB0aGlzLm1lbnVTZXJ2aWNlXG4gICAgICAub25JdGVtQ2xpY2soKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigoeyB0YWcgfSkgPT4gdGFnID09PSAnbXktY29udGV4dC1tZW51JyksXG4gICAgICAgIG1hcCgoeyBpdGVtOiB7IHRpdGxlIH0gfSkgPT4gdGl0bGUpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCh0aXRsZSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHRpdGxlKSB7XG4gICAgICAgICAgY2FzZSAnRMOpY29ubmV4aW9uJzpcbiAgICAgICAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgICAgICAucG9zdChcbiAgICAgICAgICAgICAgICBgJHt0aGlzLnNlcnZpY2VSZXN0QWRtaW4ucmVzdEJhc2VVcmx9LyR7UmVzdEFkbWluQ29uZmlnU2VydmljZS5fYXV0aFBhcmFtcy5sb2dvdXRFbmRQb2ludH1gLFxuICAgICAgICAgICAgICAgIHt9XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzcDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShHTE9CQUxTLkFVVEhfQVBQX1RPS0VOKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwoJy9sb2dpbicpO1xuICAgICAgICAgICAgICAgICAgdGhpcy5pc0F1dGggPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKEdMT0JBTFMuQVVUSF9BUFBfVE9LRU4pO1xuICAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybCgnL2xvZ2luJyk7XG4gICAgICAgICAgICAgICAgICB0aGlzLmlzQXV0aCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb24gcHJpcyBlbiBjaGFyZ2UnKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIGNoYW5nZVRoZW1lKHRoZW1lTmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy50aGVtZVNlcnZpY2UuY2hhbmdlVGhlbWUodGhlbWVOYW1lKTtcbiAgfVxuXG4gIHRvZ2dsZVNpZGViYXIoKTogYm9vbGVhbiB7XG4gICAgdGhpcy5zaWRlYmFyU2VydmljZS50b2dnbGUodHJ1ZSwgJ21lbnUtc2lkZWJhcicpO1xuICAgIHRoaXMubGF5b3V0U2VydmljZS5jaGFuZ2VMYXlvdXRTaXplKCk7XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBuYXZpZ2F0ZUhvbWUoKSB7XG4gICAgdGhpcy5tZW51U2VydmljZS5uYXZpZ2F0ZUhvbWUoKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBzaWduaW4oKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybCgnL2F1dGgvbG9naW4nKTtcbiAgfVxuICBzaWdvdXQoKSB7XG4gICAgdGhpcy5hdXRoU2VydmljZS5sb2dvdXQoJ2VtYWlsJyk7XG4gIH1cblxuICBjaGFuZ2VMYW5nKGV2ZW50KSB7XG4gICAgdGhpcy5sYW5nU2VydmljZS5zZXRMYW5ndWFnZShldmVudCk7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJoZWFkZXItY29udGFpbmVyXCI+XG4gIDxkaXYgY2xhc3M9XCJsb2dvLWNvbnRhaW5lclwiPlxuICAgIDxhIChjbGljayk9XCJ0b2dnbGVTaWRlYmFyKClcIiBocmVmPVwiI1wiIGNsYXNzPVwic2lkZWJhci10b2dnbGVcIj5cbiAgICAgIDxuYi1pY29uIGljb249XCJtZW51LTItb3V0bGluZVwiPjwvbmItaWNvbj5cbiAgICA8L2E+XG4gICAgPGEgY2xhc3M9XCJsb2dvXCIgaHJlZj1cIiNcIiAoY2xpY2spPVwibmF2aWdhdGVIb21lKClcIlxuICAgICAgPjxzcGFuPnt7IHNlcnZpY2VSZXN0QWRtaW4uc2l0ZU5hbWUgfX08L3NwYW4+PC9hXG4gICAgPlxuICA8L2Rpdj5cbiAgPG5iLXNlbGVjdFxuICAgIFtzZWxlY3RlZF09XCJjdXJyZW50VGhlbWVcIlxuICAgIChzZWxlY3RlZENoYW5nZSk9XCJjaGFuZ2VUaGVtZSgkZXZlbnQpXCJcbiAgICBzdGF0dXM9XCJwcmltYXJ5XCJcbiAgPlxuICAgIDxuYi1vcHRpb24gKm5nRm9yPVwibGV0IHRoZW1lIG9mIHRoZW1lc1wiIFt2YWx1ZV09XCJ0aGVtZS52YWx1ZVwiPlxuICAgICAge3sgdGhlbWUubmFtZSB9fTwvbmItb3B0aW9uXG4gICAgPlxuICA8L25iLXNlbGVjdD5cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPVwiaGVhZGVyLWNvbnRhaW5lclwiPlxuICA8bmItc2VsZWN0XG4gICAgW3NlbGVjdGVkXT1cImN1cnJlbnRMYW5nXCJcbiAgICAoc2VsZWN0ZWRDaGFuZ2UpPVwiY2hhbmdlTGFuZygkZXZlbnQpXCJcbiAgICBzdGF0dXM9XCJwcmltYXJ5XCJcbiAgPlxuICAgIDxuYi1vcHRpb24gKm5nRm9yPVwibGV0IGxhbmcgb2YgYXBwTGFuZ3VhZ2VcIiBbdmFsdWVdPVwibGFuZy52YWx1ZVwiPlxuICAgICAge3sgbGFuZy52YWx1ZSB8IHVwcGVyY2FzZSB9fTwvbmItb3B0aW9uXG4gICAgPlxuICA8L25iLXNlbGVjdD5cblxuICA8bmItYWN0aW9ucyBzaXplPVwic21hbGxcIj5cbiAgICA8IS0tIDxuYi1hY3Rpb24gY2xhc3M9XCJjb250cm9sLWl0ZW1cIj5cbiAgICAgIDxuYi1zZWFyY2ggdHlwZT1cInJvdGF0ZS1sYXlvdXRcIj48L25iLXNlYXJjaD5cbiAgICA8L25iLWFjdGlvbj4gLS0+XG5cbiAgICA8bmItYWN0aW9uIGNsYXNzPVwidXNlci1hY3Rpb25cIiAqbmJJc0dyYW50ZWQ9XCJbJ3ZpZXcnLCAndXNlciddXCI+XG4gICAgICA8bmItdXNlclxuICAgICAgICBbbmJDb250ZXh0TWVudV09XCJ1c2VyTWVudVwiXG4gICAgICAgIG5iQ29udGV4dE1lbnVUYWc9XCJteS1jb250ZXh0LW1lbnVcIlxuICAgICAgICBbbmFtZV09XCJ1c2VyPy5uYW1lXCJcbiAgICAgICAgW3BpY3R1cmVdPVwidXNlcj8ucGljdHVyZVwiXG4gICAgICA+XG4gICAgICA8L25iLXVzZXI+XG4gICAgPC9uYi1hY3Rpb24+XG5cbiAgICA8IS0tIDxuYi1hY3Rpb24gKm5nSWY9XCIhaXNBdXRoXCJcbiAgICAgID48YnV0dG9uIG5iQnV0dG9uIChjbGljayk9XCJzaWduaW4oKVwiIHN0YXR1cz1cInByaW1hcnlcIj5cbiAgICAgICAgQ29ubmV4aW9uXG4gICAgICA8L2J1dHRvbj48L25iLWFjdGlvblxuICAgID4gLS0+XG4gIDwvbmItYWN0aW9ucz5cbjwvZGl2PlxuIl19